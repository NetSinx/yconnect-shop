<div class="container py-3" style="min-height: 100vh">
  <h3 class="mb-4 fw-bold">Keranjang Saya</h3>

  @if (cartService.cartItems().length === 0) {
    <div class="text-center py-5">
      <i class="bi bi-cart-x fs-1 text-muted"></i>
      <p class="mt-3">Keranjangmu masih kosong.</p>
      <a routerLink="/" class="btn btn-dark">Mulai Belanja</a>
    </div>
  } @else {
    <div class="row">
      <div class="col-lg-9">
        <div class="table-responsive shadow-sm rounded border">
          <table class="table table-hover align-middle mb-0 bg-white">
            <thead class="bg-light">
              <tr>
                <th scope="col" class="text-center" style="width: 50px">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [checked]="cartService.isAllSelected()"
                    (change)="onToggleAll($event)"
                    style="cursor: pointer"
                  />
                </th>
                <th scope="col">Produk</th>
                <th scope="col">Harga Satuan</th>
                <th scope="col">Kuantitas</th>
                <th scope="col">Total Harga</th>
                <th scope="col" class="text-center">Aksi</th>
              </tr>
            </thead>
            <tbody>
              @for (item of cartService.cartItems(); track item.id) {
                <tr [class.table-active]="item.selected">
                  <td class="text-center">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [checked]="item.selected"
                      (change)="onToggleItem(item.id)"
                      style="cursor: pointer"
                    />
                  </td>

                  <td>
                    <div class="d-flex align-items-center">
                      <img
                        [src]="item.images"
                        alt="{{ item.nama }}"
                        class="rounded border me-2"
                        style="width: 50px; height: 50px; object-fit: cover"
                      />
                      <span class="fw-semibold text-truncate" style="max-width: 150px">
                        {{ item.nama }}
                      </span>
                    </div>
                  </td>

                  <td>{{ item.harga | currency: 'Rp ' : 'symbol' : '1.0-0' }}</td>

                  <td>
                    <div class="input-group input-group-sm" style="width: 100px">
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="cartService.updateQuantity(item.id, item.quantity - 1)"
                      >
                        -
                      </button>
                      <input type="text" class="form-control text-center bg-white" readonly [value]="item.quantity" />
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="cartService.updateQuantity(item.id, item.quantity + 1)"
                      >
                        +
                      </button>
                    </div>
                  </td>

                  <td class="fw-bold text-primary">
                    {{ item.harga * item.quantity | currency: 'Rp ' : 'symbol' : '1.0-0' }}
                  </td>

                  <td class="text-center">
                    <button [swal]="deleteItemCart" class="btn btn-sm btn-danger" title="Hapus Produk">
                      <i class="bi bi-trash"></i>
                    </button>
                    <swal
                      #deleteItemCart
                      title="Hapus Item"
                      text="Apakah Anda yakin ingin hapus?"
                      icon="question"
                      [focusCancel]="true"
                      [showCancelButton]="true"
                      confirmButtonText="Ya"
                      cancelButtonText="Tidak"
                      [allowEscapeKey]="false"
                      [allowOutsideClick]="false"
                      (confirm)="handleDeleteItemCart(item.id)"
                    ></swal>
                    <swal
                      #successSwal
                      title="Berhasil!"
                      text="Item berhasil dihapus."
                      icon="success"
                      [timer]="1000"
                      [showConfirmButton]="false"
                    ></swal>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>

      <div class="col-lg-3 mt-4 mt-lg-0">
        <div class="card shadow-sm border-0 bg-light">
          <div class="card-body">
            <h5 class="fw-bold mb-3">Ringkasan</h5>
            <div class="d-flex justify-content-between mb-2">
              <span class="text-muted">Total ({{ cartService.cartItems().length }} Item)</span>
            </div>
            <hr />
            <div class="d-flex justify-content-between align-items-center mb-4">
              <span class="fw-bold">Total Harga</span>
              <span class="fs-4 fw-bold text-danger">
                {{ cartService.grandTotal() | currency: 'Rp ' : 'symbol' : '1.0-0' }}
              </span>
            </div>

            <button class="btn btn-dark w-100 py-2 fw-bold" [disabled]="cartService.grandTotal() === 0">
              <i class="bi bi-credit-card me-2"></i>
              Checkout
            </button>
          </div>
        </div>
      </div>
    </div>
  }
</div>
